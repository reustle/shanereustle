<!doctype html>
<html lang='en'>
	<head>
		<meta charset='utf-8'/>
		<title>Reading HTML5 Video Data | Shane Reustle</title>
		<link rel='stylesheet' href='../static/css/blog.css'/>
		<link rel='canonical' href='http://shanereustle.com/blog/force-screen-resolutions-on-ubuntu.html'/>
		<style>
			#my_video {
				margin-left: 30px;
			}
			#my_canvas {
				display: none;
			}
		</style>
	</head>
	<body>
		<div id='wrapper'>

<h1>Reading HTML5 Video Data</h1>
<h2 class='date'>11 September 2011</h2>
<p>Foo bar test test test. I was recently trying to change the resolution of an external monitor on Ubuntu 10.10 and found that the usual xorg.conf file longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain. longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain.</p>

<video id='my_video' height='266' width='640' controls loop>
	<source src='../static/misc/cars2.webm' type='video/webm'/>
</video>
<canvas id='my_canvas'></canvas>
<div id="current_rgb">&nbsp;</div>

<p>Foo bar test test test. I was recently trying to change the resolution of an external monitor on Ubuntu 10.10 and found that the usual xorg.conf file longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain. longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain.</p>

<p>Foo bar test test test. I was recently trying to change the resolution of an external monitor on Ubuntu 10.10 and found that the usual xorg.conf file longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain. longer existed. You are able to create one by running 'X -configure' in recovery mode, but that seems like a bit of a pain.</p>
		
<script>
	
	// Main elements
	var body = document.getElementsByTagName('body')[0];
	var current_rgb = document.getElementById('current_rgb');
	var my_video = document.getElementById('my_video');
	var my_canvas = document.getElementById('my_canvas');
	var my_canvas_context = my_canvas.getContext('2d');
	
	function update_bg(){
		
		// If the video isn't playing, don't loop
		if(my_video.paused || my_video.ended){
			return false;
		}
		
		// Draw the current frame of the video onto the hidden canvas
		my_canvas_context.drawImage(my_video, 0, 0, my_video.width/2, my_video.height/2);
		
		// Pull the image data from the canvas
		var frame_data = my_canvas_context.getImageData(0, 0, my_video.width/2, my_video.height/2).data;
		
		// Get the length of the data, divide that by 4 to get the number of pixels
		// then divide that by 4 again so we check the color of every 4th pixel
		var frame_data_length = (frame_data.length / 4) / 4;
		
		// Loop through the raw image data, adding the rgb of every 4th pixel to rgb_sums
		var pixel_count = 0;
		var rgb_sums = [0, 0, 0];
		for(var i = 0; i < frame_data_length; i += 4){
			rgb_sums[0] += frame_data[i*4];
			rgb_sums[1] += frame_data[i*4+1];
			rgb_sums[2] += frame_data[i*4+2];
			pixel_count++;
		}
		
		// Average the rgb sums to get the average color of the frame in rgb
		rgb_sums[0] = Math.floor(rgb_sums[0]/pixel_count);
		rgb_sums[1] = Math.floor(rgb_sums[1]/pixel_count);
		rgb_sums[2] = Math.floor(rgb_sums[2]/pixel_count);
		
		// Set the background color to the new color
		var new_rgb = 'rgb(' + rgb_sums.join(',') + ')';
		body.style.background = new_rgb;
		
		// Update the rgb label
		current_rgb.innerHTML = new_rgb;
		
		// Repeat every 1/10th of a second
		setTimeout(update_bg, 100);
	}
	
	function init(){
		// Update the size of the canvas to match the video
		my_canvas.width = my_video.width/2;
		my_canvas.height = my_video.height/2;
		
		// Start updating the bg color
		update_bg();
	}
	
	my_video.addEventListener('play', init);

</script>

		</div>
		<script type='text/javascript' src='../static/js/ga.js'></script>
	</body>
</html>

